# RetailHub — Платформа диспетчеризации консультантов

## 1. Описание проекта

**RetailHub** — Event-Driven платформа реального времени для ритейла (DIY, Электроника),
которая связывает покупателя в физическом магазине с ближайшим свободным профильным
консультантом через сканирование QR-кода.

**Аналогия**: "Uber для консультантов" — покупатель нажал кнопку, к нему идут.

---

## 2. Проблема

| Проблема | Следствие |
|---|---|
| Покупатель тратит до **15 минут** на поиск консультанта | Потеря лояльности, уход из магазина (Churn Rate) |
| Менеджер не видит, кто из сотрудников занят, а кто нет | Хаос в управлении, неэффективное использование ресурсов |
| Отсутствие данных о скорости обслуживания | Невозможно оптимизировать процессы, нет SLA |

---

## 3. Решение

### 3.1 Для покупателя
1. Сканирует QR-код на стеллаже/в отделе
2. Открывается веб-страница: "Ищем консультанта..."
3. Консультант принимает заявку → "Консультант Иван направляется к вам!"
4. Если консультант задерживается:
   - Через **1 минуту** — появляется кнопка "Напомнить" (push консультанту)
   - Через **2 минуты** — появляется кнопка "Сменить консультанта"

### 3.2 Для консультанта (мобильное приложение)
1. Начинает смену (отмечается в приложении)
2. Получает push-уведомление о новой заявке в его отделе
3. Нажимает "Взять заявку"
4. Подходит к клиенту, обслуживает, нажимает "Завершить"

### 3.3 Для менеджера (мобильное приложение)
1. Создаёт аккаунты консультантов
2. Управляет отделами магазина
3. Генерирует и привязывает QR-коды к отделам
4. Создаёт шаблоны смен и назначает сотрудников
5. Видит аналитику: кто сколько заявок обработал, время реакции, простои

---

## 4. Архитектура

### 4.1 Архитектурный стиль
**Asynchronous Event-Driven Architecture** — система не ждёт синхронного ответа,
а рассылает события через Apache Kafka и обрабатывает реакции асинхронно.

### 4.2 Модульный монолит
Проект реализован как **модульный монолит** для лёгкого перехода на микросервисы:

| Модуль | Ответственность |
|---|---|
| `module-auth` | JWT-аутентификация, управление пользователями |
| `module-store` | Магазины, отделы, QR-коды |
| `module-dispatch` | Заявки, диспетчеризация, жизненный цикл обслуживания |
| `module-shift` | Расписание смен, clock-in/clock-out |
| `module-notification` | Push-уведомления (FCM), inbox |
| `module-analytics` | Дашборд менеджера, статистика консультантов |
| `common` | Общие DTO, события Kafka, исключения |
| `app` | Точка запуска Spring Boot |

### 4.3 Технологический стек

| Компонент | Технология |
|---|---|
| Backend Framework | Spring Boot 4.x |
| Язык | Java 25 |
| База данных | PostgreSQL |
| Миграции | Flyway |
| Аутентификация | JWT (access + refresh) |
| Очередь сообщений | Apache Kafka |
| Push-уведомления | Firebase Cloud Messaging (FCM) |
| API-документация | OpenAPI 3.1 + Swagger UI |
| Маппинг | MapStruct |

### 4.4 Multi-tenant модель
Один сервер обслуживает множество изолированных магазинов. Каждый менеджер
привязан к одному магазину и видит только данные своего магазина.

---

## 5. Kafka-топики

| Топик | Описание |
|---|---|
| `request-events` | Создание, назначение, завершение, эскалация заявок |
| `shift-events` | Начало/конец смены, clock-in/clock-out |
| `notification-commands` | Команды на отправку push и inbox-уведомлений |

---

## 6. Ролевая модель

### MANAGER
- Создаёт аккаунты консультантов
- Управляет отделами и QR-кодами
- Создаёт шаблоны смен и назначает персонал
- Просматривает аналитику и статистику
- Может отменять заявки и вручную эскалировать

### CONSULTANT
- Логинится, начинает/завершает смену
- Получает push-уведомления о заявках
- Берёт и завершает заявки
- Видит свои уведомления и смены

### CLIENT (неавторизованный)
- Сканирует QR-код
- Видит статус заявки на веб-странице
- Может напомнить консультанту (через 1 мин)
- Может запросить смену консультанта (через 2 мин)

---

## 7. SLA и эскалация

- **SLA на реакцию** (`sla_reaction_seconds`): время, за которое заявка должна быть взята
  консультантом. По умолчанию — 5 минут.
- **SLA на обслуживание** (`sla_service_seconds`): максимальное время обслуживания.
  По умолчанию — 15 минут.
- **Автоматическая эскалация**: если заявка не взята за SLA-время, статус меняется на
  `ESCALATED`, менеджер получает уведомление.

---

## 8. Команда

| Роль | Участник | Зона ответственности |
|---|---|---|
| Backend-разработчик | Матвей | Серверная часть, API, БД, Kafka |
| Мобильный разработчик | Илья | Android/iOS приложение для консультантов и менеджеров |
| Системный аналитик | Федя | Спецификации, требования, тестирование, документация |
